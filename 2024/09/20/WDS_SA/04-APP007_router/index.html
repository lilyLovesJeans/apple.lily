<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.2.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/apple.lily/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/apple.lily/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/apple.lily/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/apple.lily/images/logo.svg" color="#222">

<link rel="stylesheet" href="/apple.lily/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"lilylovesjeans.github.io","root":"/apple.lily/","images":"/apple.lily/images","scheme":"Gemini","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜尋...","empty":"我們無法找到任何有關 ${query} 的搜索結果","hits_time":"${hits} 找到 ${time} 個結果","hits":"找到 ${hits} 個結果"}}</script><script src="/apple.lily/js/config.js"></script>

    <meta name="description" content="App007 router說明">
<meta property="og:type" content="article">
<meta property="og:title" content="App007 router說明">
<meta property="og:url" content="https://lilylovesjeans.github.io/apple.lily/2024/09/20/WDS_SA/04-APP007_router/index.html">
<meta property="og:site_name" content="Apple.Lily 前端學習筆記">
<meta property="og:description" content="App007 router說明">
<meta property="og:locale" content="zh_TW">
<meta property="article:published_time" content="2024-09-19T16:24:16.000Z">
<meta property="article:modified_time" content="2024-09-19T16:40:03.000Z">
<meta property="article:author" content="Apple.Lily">
<meta property="article:tag" content="C#">
<meta property="article:tag" content="SA">
<meta property="article:tag" content="UML">
<meta property="article:tag" content="APP007">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://lilylovesjeans.github.io/apple.lily/2024/09/20/WDS_SA/04-APP007_router/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-TW","comments":true,"permalink":"https://lilylovesjeans.github.io/apple.lily/2024/09/20/WDS_SA/04-APP007_router/","path":"2024/09/20/WDS_SA/04-APP007_router/","title":"App007 router說明"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>App007 router說明 | Apple.Lily 前端學習筆記</title>
  








  <noscript>
    <link rel="stylesheet" href="/apple.lily/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切換導航欄" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/apple.lily/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Apple.Lily 前端學習筆記</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">記錄 創作 設計</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜尋" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/apple.lily/" rel="section"><i class="fa fa-home fa-fw"></i>首頁</a></li><li class="menu-item menu-item-about"><a href="/apple.lily/about/" rel="section"><i class="fa-solid fa-face-smile fa-fw"></i>關於</a></li><li class="menu-item menu-item-tags"><a href="/apple.lily/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>標籤</a></li><li class="menu-item menu-item-categories"><a href="/apple.lily/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分類</a></li><li class="menu-item menu-item-archives"><a href="/apple.lily/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>歸檔</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目錄
        </li>
        <li class="sidebar-nav-overview">
          本站概要
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-APP007Controller-%E9%A1%9E%E5%88%A5"><span class="nav-number">1.</span> <span class="nav-text">1. APP007Controller 類別</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E5%BB%BA%E6%A7%8B%E5%AD%90"><span class="nav-number">2.</span> <span class="nav-text">2. 建構子</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E4%B8%8B%E6%8B%89%E9%81%B8%E5%96%AE-%E6%AA%94%E6%A1%88%E6%A0%BC%E5%BC%8F"><span class="nav-number">3.</span> <span class="nav-text">3. 下拉選單 &#x3D;&gt; 檔案格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%AA%A2%E6%9F%A5%E6%89%B9%E8%99%9F%E4%B8%A6%E5%8F%96%E5%BE%97%E6%AA%94%E6%A1%88%E5%90%8D%E7%A8%B1"><span class="nav-number">4.</span> <span class="nav-text">4. 檢查批號並取得檔案名稱</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%AA%94%E6%A1%88%E5%90%8D%E7%A8%B1%E6%A0%BC%E5%BC%8F"><span class="nav-number">4.1.</span> <span class="nav-text">檔案名稱格式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%99%E4%BA%9B%E6%AA%94%E6%A1%88%E7%9A%84%E6%BD%9B%E5%9C%A8%E7%94%A8%E9%80%94"><span class="nav-number">4.2.</span> <span class="nav-text">這些檔案的潛在用途</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E5%9F%B7%E8%A1%8C-%E4%BD%9C%E6%A5%AD"><span class="nav-number">5.</span> <span class="nav-text">5. 執行 作業</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E7%9A%84%E6%AA%94%E6%A1%88"><span class="nav-number">5.1.</span> <span class="nav-text">生成的檔案</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E7%B6%AD%E8%AD%B7%E8%A6%96%E7%AA%97-%E6%9F%A5%E8%A9%A2"><span class="nav-number">6.</span> <span class="nav-text">6. 維護視窗 查詢</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-%E7%B6%AD%E8%AD%B7%E8%A6%96%E7%AA%97-%E7%B6%AD%E8%AD%B7-%E4%BD%9C%E6%A5%AD"><span class="nav-number">7.</span> <span class="nav-text">7. 維護視窗 維護 作業</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-%E7%B6%AD%E8%AD%B7%E8%A6%96%E7%AA%97-%E5%8A%A0%E5%AF%86-%E4%BD%9C%E6%A5%AD"><span class="nav-number">8.</span> <span class="nav-text">8. 維護視窗 加密 作業</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B8%BD%E7%B5%90"><span class="nav-number">9.</span> <span class="nav-text">總結</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Apple.Lily"
      src="https://i.imgur.com/Qxhx2zz.png">
  <p class="site-author-name" itemprop="name">Apple.Lily</p>
  <div class="site-description" itemprop="description">Front End Engineer <br> 每日一筆記 不斷學習 趕上進度</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/apple.lily/archives/">
          <span class="site-state-item-count">467</span>
          <span class="site-state-item-name">文章</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/apple.lily/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分類</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/apple.lily/tags/">
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">標籤</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-TW">
    <link itemprop="mainEntityOfPage" href="https://lilylovesjeans.github.io/apple.lily/2024/09/20/WDS_SA/04-APP007_router/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://i.imgur.com/Qxhx2zz.png">
      <meta itemprop="name" content="Apple.Lily">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Apple.Lily 前端學習筆記">
      <meta itemprop="description" content="Front End Engineer <br> 每日一筆記 不斷學習 趕上進度">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="App007 router說明 | Apple.Lily 前端學習筆記">
      <meta itemprop="description" content="App007 router說明">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          App007 router說明
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">發表於</span>
      

      <time title="創建時間：2024-09-20 00:24:16 / 修改時間：00:40:03" itemprop="dateCreated datePublished" datetime="2024-09-20T00:24:16+08:00">2024-09-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分類於</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/apple.lily/categories/WDS/" itemprop="url" rel="index"><span itemprop="name">WDS</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="閱讀次數" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">閱讀次數：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

            <div class="post-description">App007 router說明</div>
        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>APP007 router說明:<br>程式名稱: APP007Controller.cs<br>這段程式碼是 ASP.NET Core 中的 Controller 類別，用於處理名為 <code>APP007</code> 的 Web API 相關請求。這個 Controller 類別提供了各種 API 端點，以便進行檔案格式查詢、批號檢查、作業執行、維護視窗查詢及維護作業等功能。下面逐段解釋這段程式碼：</p>
<h3 id="1-APP007Controller-類別"><a href="#1-APP007Controller-類別" class="headerlink" title="1. APP007Controller 類別"></a>1. <code>APP007Controller</code> 類別</h3><p>這個類別繼承自 <code>BaseController</code>，並使用了 ASP.NET Core 的 API 控制器特性 <code>[ApiController]</code> 和路由特性 <code>[Route(&quot;api/[controller]&quot;)]</code>。這意味著該控制器的所有端點都會以 <code>api/APP007</code> 為基礎路由。</p>
<h3 id="2-建構子"><a href="#2-建構子" class="headerlink" title="2. 建構子"></a>2. 建構子</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">APP007Controller</span>(<span class="params">APP007Service service, CommonService commonService, ILogger&lt;APP007Controller&gt; logger</span>) : <span class="title">base</span>(<span class="params">logger</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    _service = service;</span><br><span class="line">    _commonService = commonService;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>APP007Controller</code> 類別的建構子接收三個參數：<code>APP007Service</code>、<code>CommonService</code> 和 <code>ILogger&lt;APP007Controller&gt;</code>。</li>
<li><code>APP007Service</code> 和 <code>CommonService</code> 是業務邏輯層的服務，<code>ILogger</code> 用於記錄日誌。</li>
<li><code>base(logger)</code> 呼叫父類別 <code>BaseController</code> 的建構子。</li>
</ul>
<h3 id="3-下拉選單-檔案格式"><a href="#3-下拉選單-檔案格式" class="headerlink" title="3. 下拉選單 &#x3D;&gt; 檔案格式"></a>3. 下拉選單 &#x3D;&gt; 檔案格式</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Route(<span class="string">&quot;GetFileTypePercentList&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">HttpGet</span>]</span><br><span class="line"><span class="keyword">public</span> ApiResult&lt;List&lt;SysParm_OutputVo&gt;&gt; GetFileTypePercentListResult()</span><br></pre></td></tr></table></figure>

<ul>
<li><p>這個端點使用 <code>GET</code> 請求來獲取檔案格式的下拉選單數據。</p>
</li>
<li><p>調用 <code>_commonService.GetFileTypePercentListResult()</code> 獲取檔案格式列表。 Table為 : SYS_PARM_D</p>
</li>
<li><p>根據返回的狀態設置 <code>ApiResult</code> 的 <code>RESULT_CODE</code> 和 <code>RESULT_MESSAGE</code>。</p>
</li>
<li><p>程式碼: </p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">List</span>&lt;<span class="title">SYS_PARM_D</span>&gt; <span class="title">QueryByParmId</span>(<span class="params"><span class="built_in">string</span> PARM_ID</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> _repository.Connection().Query&lt;SYS_PARM_D&gt;(@<span class="string">$&quot;SELECT * FROM SYS_PARM_D WHERE PARM_ID = &#x27;<span class="subst">&#123;PARM_ID&#125;</span>&#x27; &quot;</span>).ToList();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>程式碼:</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">region</span> 檢查批號並取得檔案名稱</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServiceResult&lt;OpenCheckSeq_OutputVo&gt; <span class="title">CheckOpenCheckSeqResult</span>(<span class="params">OpenCheckSeq_InputVo inputVo</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    ServiceResult&lt;OpenCheckSeq_OutputVo&gt; serviceResult = <span class="keyword">new</span> ServiceResult&lt;OpenCheckSeq_OutputVo&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        OpenCheckSeq_OutputVo result = <span class="keyword">new</span> OpenCheckSeq_OutputVo();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//先檢查批號是否存在</span></span><br><span class="line">        <span class="keyword">var</span> rtn = _nP_DETAILDao.HasOpenCheckSeq(inputVo.P_OPEN_CHECK_SEQ);</span><br><span class="line">        <span class="keyword">if</span> (!rtn)</span><br><span class="line">        &#123;</span><br><span class="line">            serviceResult.status = CommonEnum.ACTION_STATUS.NOTFOUND;</span><br><span class="line">            serviceResult.message = <span class="built_in">string</span>.Format(SysMessage.B0010003, <span class="string">&quot;批號&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//有批號再檢查單據是否存在</span></span><br><span class="line">            <span class="keyword">var</span> document_no = _nP_DETAILDao.QueryDocumentNo(<span class="keyword">this</span>.CompanyId, inputVo.P_OPEN_CHECK_SEQ);</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(document_no))</span><br><span class="line">            &#123;</span><br><span class="line">                serviceResult.status = CommonEnum.ACTION_STATUS.NOTFOUND;</span><br><span class="line">                serviceResult.message = <span class="built_in">string</span>.Format(SysMessage.B0010003, <span class="string">&quot;單據號碼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                result.P_FILENAME_1 = inputVo.P_OPEN_CHECK_SEQ + <span class="string">&quot;加密-&quot;</span> + document_no + <span class="string">&quot;.TXT&quot;</span>;</span><br><span class="line">                result.P_FILENAME_2 = inputVo.P_OPEN_CHECK_SEQ + <span class="string">&quot;-&quot;</span> + document_no + <span class="string">&quot;.TXT&quot;</span>;</span><br><span class="line">                serviceResult.status = CommonEnum.ACTION_STATUS.SUCCESS;</span><br><span class="line">                serviceResult.message = SysMessage.S0100001;</span><br><span class="line">                serviceResult.result = result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">    &#123;</span><br><span class="line">        serviceResult.status = CommonEnum.ACTION_STATUS.FAILURE;</span><br><span class="line">        serviceResult.message = ex.Message;</span><br><span class="line">        serviceResult.ex = ex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> serviceResult;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endregion</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="4-檢查批號並取得檔案名稱"><a href="#4-檢查批號並取得檔案名稱" class="headerlink" title="4. 檢查批號並取得檔案名稱"></a>4. 檢查批號並取得檔案名稱</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Route(<span class="string">&quot;CheckOpenCheckSeq&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">HttpPost</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> ApiResult&lt;OpenCheckSeq_OutputVo&gt; <span class="title">CheckOpenCheckSeq</span>(<span class="params">OpenCheckSeq_InputVo inputVo</span>)</span></span><br></pre></td></tr></table></figure>

<ul>
<li>這個端點使用 <code>POST</code> 請求來檢查批號並取得檔案名稱。<br>CheckOpenCheckSeqResult 方法的目的是驗證提供的批號是否存在，<br>並根據批號查詢相關的單據號碼，最終生成檔案名稱。<br>如果批號或單據號碼不存在，方法會返回相應的錯誤信息。</li>
</ul>
<p>在 <code>CheckOpenCheckSeqResult</code> 方法中生成的兩個檔案名稱 <code>P_FILENAME_1</code> 和 <code>P_FILENAME_2</code> 是基於批號和單據號碼創建的檔案名稱。這些檔案名稱通常用於後續的文件處理或保存操作，具體用途取決於應用的業務邏輯。讓我們詳細看看這兩個檔案名稱的格式和含義：</p>
<h4 id="檔案名稱格式"><a href="#檔案名稱格式" class="headerlink" title="檔案名稱格式"></a>檔案名稱格式</h4><ol>
<li><p><strong><code>P_FILENAME_1</code></strong>:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result.P_FILENAME_1 = inputVo.P_OPEN_CHECK_SEQ + <span class="string">&quot;加密-&quot;</span> + document_no + <span class="string">&quot;.TXT&quot;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>格式</strong>: <code>批號 + &quot;加密-&quot; + 單據號碼 + &quot;.TXT&quot;</code></li>
<li><strong>示例</strong>: <code>20230920加密-12345.TXT</code></li>
<li><strong>用途</strong>: 這個檔案名稱可能用於表示一個經過加密處理的檔案。批號和單據號碼組合在一起，用於唯一標識這個檔案。</li>
</ul>
</li>
<li><p><strong><code>P_FILENAME_2</code></strong>:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">result.P_FILENAME_2 = inputVo.P_OPEN_CHECK_SEQ + <span class="string">&quot;-&quot;</span> + document_no + <span class="string">&quot;.TXT&quot;</span>;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>格式</strong>: <code>批號 + &quot;-&quot; + 單據號碼 + &quot;.TXT&quot;</code></li>
<li><strong>示例</strong>: <code>20230920-12345.TXT</code></li>
<li><strong>用途</strong>: 這個檔案名稱可能用於表示原始或未經加密處理的檔案。它直接包含批號和單據號碼。</li>
</ul>
</li>
</ol>
<h4 id="這些檔案的潛在用途"><a href="#這些檔案的潛在用途" class="headerlink" title="這些檔案的潛在用途"></a>這些檔案的潛在用途</h4><ol>
<li><p><strong>檔案加密和儲存</strong>:</p>
<ul>
<li><code>P_FILENAME_1</code> 可能是加密後的檔案，這意味著在生成這個檔案名稱後，系統可能會對檔案進行加密處理以保護其內容。</li>
</ul>
</li>
<li><p><strong>文件處理和記錄</strong>:</p>
<ul>
<li><code>P_FILENAME_2</code> 可能是用於保存未加密的檔案或作為記錄用途的檔案名稱。這些檔案名稱可以幫助在系統中唯一標識文件，並進行後續的檔案處理操作。</li>
</ul>
</li>
<li><p><strong>資料備份</strong>:</p>
<ul>
<li>這些檔案名稱可能用於資料備份或報告生成，幫助系統根據批號和單據號碼生成對應的檔案，並進行系統內部的資料管理。</li>
</ul>
</li>
</ol>
<p>總的來說，<code>P_FILENAME_1</code> 和 <code>P_FILENAME_2</code> 是根據業務需求生成的檔案名稱，用於文件處理、加密和記錄等目的。具體的用途會根據應用的具體實現和業務需求來決定。</p>
<ul>
<li>調用 <code>_service.CheckOpenCheckSeqResult(inputVo)</code> 獲取結果。</li>
<li>根據返回的狀態設置 <code>ApiResult</code> 的 <code>RESULT_CODE</code> 和 <code>RESULT_MESSAGE</code>。<br>程式碼:<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">region</span> 檢查批號並取得檔案名稱</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServiceResult&lt;OpenCheckSeq_OutputVo&gt; <span class="title">CheckOpenCheckSeqResult</span>(<span class="params">OpenCheckSeq_InputVo inputVo</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    ServiceResult&lt;OpenCheckSeq_OutputVo&gt; serviceResult = <span class="keyword">new</span> ServiceResult&lt;OpenCheckSeq_OutputVo&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        OpenCheckSeq_OutputVo result = <span class="keyword">new</span> OpenCheckSeq_OutputVo();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//先檢查批號是否存在</span></span><br><span class="line">        <span class="keyword">var</span> rtn = _nP_DETAILDao.HasOpenCheckSeq(inputVo.P_OPEN_CHECK_SEQ);</span><br><span class="line">        <span class="keyword">if</span> (!rtn)</span><br><span class="line">        &#123;</span><br><span class="line">            serviceResult.status = CommonEnum.ACTION_STATUS.NOTFOUND;</span><br><span class="line">            serviceResult.message = <span class="built_in">string</span>.Format(SysMessage.B0010003, <span class="string">&quot;批號&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//有批號再檢查單據是否存在</span></span><br><span class="line">            <span class="keyword">var</span> document_no = _nP_DETAILDao.QueryDocumentNo(<span class="keyword">this</span>.CompanyId, inputVo.P_OPEN_CHECK_SEQ);</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">string</span>.IsNullOrEmpty(document_no))</span><br><span class="line">            &#123;</span><br><span class="line">                serviceResult.status = CommonEnum.ACTION_STATUS.NOTFOUND;</span><br><span class="line">                serviceResult.message = <span class="built_in">string</span>.Format(SysMessage.B0010003, <span class="string">&quot;單據號碼&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                result.P_FILENAME_1 = inputVo.P_OPEN_CHECK_SEQ + <span class="string">&quot;加密-&quot;</span> + document_no + <span class="string">&quot;.TXT&quot;</span>;</span><br><span class="line">                result.P_FILENAME_2 = inputVo.P_OPEN_CHECK_SEQ + <span class="string">&quot;-&quot;</span> + document_no + <span class="string">&quot;.TXT&quot;</span>;</span><br><span class="line">                serviceResult.status = CommonEnum.ACTION_STATUS.SUCCESS;</span><br><span class="line">                serviceResult.message = SysMessage.S0100001;</span><br><span class="line">                serviceResult.result = result;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Exception ex)</span><br><span class="line">    &#123;</span><br><span class="line">        serviceResult.status = CommonEnum.ACTION_STATUS.FAILURE;</span><br><span class="line">        serviceResult.message = ex.Message;</span><br><span class="line">        serviceResult.ex = ex;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> serviceResult;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endregion</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="5-執行-作業"><a href="#5-執行-作業" class="headerlink" title="5. 執行 作業"></a>5. 執行 作業</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Route(<span class="string">&quot;ExportPaymentFile&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">HttpPost</span>]</span><br><span class="line">[<span class="meta">Authorize</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;ApiResult&lt;APP007_OutputVo&gt;&gt; ExportPaymentFile([FromBody] APP007_InputVo inputVo)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>這個端點使用 <code>POST</code> 請求來執行作業，並且要求授權 <code>[Authorize]</code>。</p>
</li>
<li><p>調用 <code>_service.ExportPaymentFileResult(inputVo)</code> 獲取結果。</p>
</li>
<li><p>根據返回的狀態設置 <code>ApiResult</code> 的 <code>RESULT_CODE</code> 和 <code>RESULT_MESSAGE</code>。</p>
</li>
</ul>
<h4 id="生成的檔案"><a href="#生成的檔案" class="headerlink" title="生成的檔案"></a>生成的檔案</h4><p>在 <code>ExportPaymentFileResult</code> 方法中，生成了兩個檔案名稱：</p>
<ol>
<li><strong>主檔</strong> (<code>fileName</code>): 由 <code>FileExportHelper.CreateFileFromList</code> 方法生成，根據 <code>paymentData</code> 列表內容產生的 TXT 檔案。</li>
<li><strong>加密檔案</strong>: 由 <code>DoEncryption</code> 或 <code>DoEncryptionCUB</code> 方法對主檔進行加密處理後生成。</li>
</ol>
<h3 id="6-維護視窗-查詢"><a href="#6-維護視窗-查詢" class="headerlink" title="6. 維護視窗 查詢"></a>6. 維護視窗 查詢</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Route(<span class="string">&quot;Query&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">HttpPost</span>]</span><br><span class="line">[<span class="meta">Authorize</span>]</span><br><span class="line"><span class="keyword">public</span> ApiResult&lt;List&lt;APP007Q_OutputVo&gt;&gt; Post([FromBody] APP007Q_InputVo inputVo)</span><br></pre></td></tr></table></figure>

<ul>
<li>這個端點使用 <code>POST</code> 請求來查詢維護視窗的數據，並且要求授權 <code>[Authorize]</code>。</li>
<li>調用 <code>_service.QueryResult(inputVo)</code> 獲取結果。</li>
<li>根據返回的狀態設置 <code>ApiResult</code> 的 <code>RESULT_CODE</code> 和 <code>RESULT_MESSAGE</code>。</li>
<li>透過 _dao.Query(inputVo) 執行查詢，並將結果儲存在 list 中。<br>如果查詢到結果，則回傳成功狀態並記錄結果；如果查詢不到資料，則回傳「查無資料」的訊息。</li>
</ul>
<h3 id="7-維護視窗-維護-作業"><a href="#7-維護視窗-維護-作業" class="headerlink" title="7. 維護視窗 維護 作業"></a>7. 維護視窗 維護 作業</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Route(<span class="string">&quot;Edit&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">HttpPut</span>]</span><br><span class="line">[<span class="meta">Authorize</span>]</span><br><span class="line"><span class="function"><span class="keyword">public</span> ApiResult&lt;<span class="built_in">int</span>&gt; <span class="title">Edit</span>(<span class="params">[FromBody] </span></span></span><br></pre></td></tr></table></figure>

<pre><code>- 這個端點使用 `PUT` 請求來執行維護視窗的維護作業，並且要求授權 `[Authorize]`。
- 調用 `_service.EditResult(inputVoList)` 獲取結果。
- 根據返回的狀態設置 `ApiResult` 的 `RESULT_CODE` 和 `RESULT_MESSAGE`。
- 使用兩層 for 迴圈處理多筆資料。第一層迴圈遍歷 inputVoList 中的每一筆資料，
第二層迴圈處理 BLOCK_DETAIL 裡的每一筆明細。
**更新與刪除操作：**
- 在 `BLOCK_DETAIL` 的明細中，根據 `_MARK()` 的值來決定當前明細需要更新 (`UPDATE`) 還是刪除 (`DELETE`)：
    - 如果是更新操作 (`UPDATE`)，會呼叫 `_aPP017_DETAILDao.Update()` 方法，並檢查結果是否為 1。如果失敗，則記錄錯誤訊息並將 `status` 設為 `false`。
    - 如果是刪除操作 (`DELETE`)，則呼叫 `_aPP017_DETAILDao.DeleteByRowid()` 方法，並檢查結果是否為 1。如果失敗，則同樣記錄錯誤訊息並將 `status` 設為 `false`。
-    - 如果所有操作成功 (`status == true`)，將提交交易 `_dao.Commit()`，並將成功訊息和處理的筆數記錄在 `serviceResult` 中。
    - 如果有任意一筆失敗，則會回滾操作 `_dao.RollBack()`，並回傳錯誤訊息。
</code></pre>
<h3 id="8-維護視窗-加密-作業"><a href="#8-維護視窗-加密-作業" class="headerlink" title="8. 維護視窗 加密 作業"></a>8. 維護視窗 加密 作業</h3><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">Route(<span class="string">&quot;Encryption&quot;</span>)</span>]</span><br><span class="line">[<span class="meta">HttpPost</span>]</span><br><span class="line">[<span class="meta">Authorize</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">async</span> Task&lt;ApiResult&lt;APP007_OutputVo&gt;&gt; Encryption([FromBody] APP007_InputVo inputVo)</span><br></pre></td></tr></table></figure>

<ul>
<li><p>這個端點使用 <code>POST</code> 請求來執行維護視窗的加密作業，並且要求授權 <code>[Authorize]</code>。</p>
</li>
<li><p>調用 <code>_service.EncryptionResult(inputVo)</code> 獲取結果。</p>
</li>
<li><p>根據返回的狀態設置 <code>ApiResult</code> 的 <code>RESULT_CODE</code> 和 <code>RESULT_MESSAGE</code>。</p>
</li>
<li><p><strong>TXT 檔案生成</strong>：</p>
<ul>
<li>如果資料查詢成功，則會根據查詢結果產生 TXT 檔案。透過 <code>FileExportHelper.CreateFileFromList()</code> 方法來將支付資料轉換為 CSV 格式的檔案。如果檔案生成失敗，則記錄錯誤訊息並將 <code>status</code> 設置為 <code>false</code>。</li>
</ul>
</li>
<li><p><strong>加密</strong>：</p>
<ul>
<li>在檔案生成成功後，會根據 <code>P_FILE_TYPE</code> 決定使用哪個加密方法（例如 <code>DoEncryption</code> 或 <code>DoEncryptionCUB</code>）。如果加密失敗，則會記錄錯誤訊息並停止處理。</li>
</ul>
</li>
</ul>
<h3 id="總結"><a href="#總結" class="headerlink" title="總結"></a>總結</h3><p>這個 <code>APP007Controller</code> 類別管理與 <code>APP007</code> 相關的各種 API 端點。每個端點都處理不同的業務邏輯操作，例如查詢檔案格式、檢查批號、執行作業、查詢和維護數據、加密作業等。控制器中的每個方法都通過調用相應的服務層方法來處理業務邏輯，並根據操作結果返回相應的 <code>ApiResult</code>。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/apple.lily/tags/C/" rel="tag"># C#</a>
              <a href="/apple.lily/tags/SA/" rel="tag"># SA</a>
              <a href="/apple.lily/tags/UML/" rel="tag"># UML</a>
              <a href="/apple.lily/tags/APP007/" rel="tag"># APP007</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/apple.lily/2024/09/19/WDS_SA/03-APP007/" rel="prev" title="App007 加密解釋">
                  <i class="fa fa-angle-left"></i> App007 加密解釋
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/apple.lily/2024/09/21/SA_Howto/01.SA_WhatIsUMl/" rel="next" title="01.「模組化」、「抽象化」、「繼承與多態」、「組合概念">
                  01.「模組化」、「抽象化」、「繼承與多態」、「組合概念 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">若要轉載文章，麻煩請保留原作者名稱與原始連結。</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="訪客總數">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="總瀏覽次數">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="回到頂端">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/apple.lily/js/comments.js"></script><script src="/apple.lily/js/utils.js"></script><script src="/apple.lily/js/motion.js"></script><script src="/apple.lily/js/sidebar.js"></script><script src="/apple.lily/js/next-boot.js"></script>

  






  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/apple.lily/js/third-party/math/mathjax.js"></script>



</body>
</html>
