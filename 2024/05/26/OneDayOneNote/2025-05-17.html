<hr>
<h2 id="title-2025-05-17-gateway-mjs-MCP-Gateway-çš„æœ€å°ç‰ˆä¼ºæœå™¨è§£é‡‹date-2025-09-21-00-07-22categories-OneDayOneNotetags-æ¶æ§‹è¨­è¨ˆ-node-MCP-description-2025-05-17-gateway-mjs-MCP-Gateway-çš„æœ€å°ç‰ˆä¼ºæœå™¨è§£é‡‹"><a href="#title-2025-05-17-gateway-mjs-MCP-Gateway-çš„æœ€å°ç‰ˆä¼ºæœå™¨è§£é‡‹date-2025-09-21-00-07-22categories-OneDayOneNotetags-æ¶æ§‹è¨­è¨ˆ-node-MCP-description-2025-05-17-gateway-mjs-MCP-Gateway-çš„æœ€å°ç‰ˆä¼ºæœå™¨è§£é‡‹" class="headerlink" title="title: 2025-05-17 gateway.mjs  MCP Gateway çš„æœ€å°ç‰ˆä¼ºæœå™¨è§£é‡‹date: 2025-09-21 00:07:22categories: OneDayOneNotetags:  [æ¶æ§‹è¨­è¨ˆ,node,MCP]description:  2025-05-17 gateway.mjs  MCP Gateway çš„æœ€å°ç‰ˆä¼ºæœå™¨è§£é‡‹"></a>title: 2025-05-17 gateway.mjs  MCP Gateway çš„æœ€å°ç‰ˆä¼ºæœå™¨è§£é‡‹<br>date: 2025-09-21 00:07:22<br>categories: OneDayOneNote<br>tags:  [æ¶æ§‹è¨­è¨ˆ,node,MCP]<br>description:  2025-05-17 gateway.mjs  MCP Gateway çš„æœ€å°ç‰ˆä¼ºæœå™¨è§£é‡‹</h2><h1 id="2025-05-17-gateway-mjs-MCP-Gateway-çš„æœ€å°ç‰ˆä¼ºæœå™¨è§£é‡‹"><a href="#2025-05-17-gateway-mjs-MCP-Gateway-çš„æœ€å°ç‰ˆä¼ºæœå™¨è§£é‡‹" class="headerlink" title="2025-05-17 gateway.mjs  MCP Gateway çš„æœ€å°ç‰ˆä¼ºæœå™¨è§£é‡‹"></a>2025-05-17 gateway.mjs  MCP Gateway çš„æœ€å°ç‰ˆä¼ºæœå™¨è§£é‡‹</h1><p>å¾ˆå¥½ ğŸ‘Œ é€™ä»½ <code>gateway.mjs</code> å°±æ˜¯ä½  MCP Gateway çš„æœ€å°ç‰ˆä¼ºæœå™¨ã€‚æˆ‘å¹«ä½ é€æ®µè§£é‡‹ï¼Œæœ€å¾Œæ•´ç†å‡ºé‡é»ã€‚</p>
<hr>
<h2 id="ğŸ”-ç¨‹å¼é€æ®µèªªæ˜"><a href="#ğŸ”-ç¨‹å¼é€æ®µèªªæ˜" class="headerlink" title="ğŸ” ç¨‹å¼é€æ®µèªªæ˜"></a>ğŸ” ç¨‹å¼é€æ®µèªªæ˜</h2><h3 id="1-åŒ¯å…¥æ¨¡çµ„-å•Ÿå‹•è¨­å®š"><a href="#1-åŒ¯å…¥æ¨¡çµ„-å•Ÿå‹•è¨­å®š" class="headerlink" title="1. åŒ¯å…¥æ¨¡çµ„ &amp; å•Ÿå‹•è¨­å®š"></a>1. åŒ¯å…¥æ¨¡çµ„ &amp; å•Ÿå‹•è¨­å®š</h3><pre><code class="js">import express from &#39;express&#39;;
import dotenv from &#39;dotenv&#39;;
dotenv.config();
const app = express();
app.use(express.json());
</code></pre>
<ul>
<li><code>express</code> â†’ Node.js æœ€å¸¸ç”¨çš„ Web æ¡†æ¶ï¼Œç”¨ä¾†å»º APIã€‚</li>
<li><code>dotenv</code> â†’ è®€å– <code>.env</code> æª”æ¡ˆï¼ŒæŠŠè£¡é¢çš„è¨­å®šå€¼æ”¾åˆ° <code>process.env</code> è£¡ã€‚</li>
<li><code>dotenv.config()</code> â†’ é€™è¡Œæœƒè‡ªå‹•è®€å– <code>.env</code>ã€‚</li>
<li><code>app.use(express.json())</code> â†’ è®“ Express å¯ä»¥è§£æ JSON æ ¼å¼çš„ request bodyã€‚</li>
</ul>
<hr>
<h3 id="2-è®€å–ç’°å¢ƒè®Šæ•¸"><a href="#2-è®€å–ç’°å¢ƒè®Šæ•¸" class="headerlink" title="2. è®€å–ç’°å¢ƒè®Šæ•¸"></a>2. è®€å–ç’°å¢ƒè®Šæ•¸</h3><pre><code class="js">const OPENAI_KEY = process.env.OPENAI_API_KEY || &#39;&#39;;
const DEEPSEEK_KEY = process.env.DEEPSEEK_API_KEY || &#39;&#39;;
</code></pre>
<ul>
<li>å˜—è©¦è®€ <code>.env</code> è£¡çš„ <code>OPENAI_API_KEY</code> å’Œ <code>DEEPSEEK_API_KEY</code>ã€‚</li>
<li>å¦‚æœæ²’è¨­å®šï¼Œé è¨­å°±æ˜¯ç©ºå­—ä¸²ï¼ˆæ–¹ä¾¿ä¹‹å¾Œç”¨ã€Œmock æ¨¡å¼ã€æ¸¬è©¦ï¼‰ã€‚</li>
</ul>
<hr>
<h3 id="3-Providersï¼ˆæä¾›è€…é©é…å™¨ï¼‰"><a href="#3-Providersï¼ˆæä¾›è€…é©é…å™¨ï¼‰" class="headerlink" title="3. Providersï¼ˆæä¾›è€…é©é…å™¨ï¼‰"></a>3. Providersï¼ˆæä¾›è€…é©é…å™¨ï¼‰</h3><pre><code class="js">const providers = {
  openai: async ({ messages }) =&gt; {
    if (!OPENAI_KEY) return { text: &#39;[mock openai] é€™æ˜¯æ¨¡æ“¬å›è¦†&#39; };
    ...
  },

  deepseek: async ({ messages }) =&gt; {
    if (!DEEPSEEK_KEY) return { text: &#39;[mock deepseek] é€™æ˜¯æ¨¡æ“¬å›è¦†&#39; };
    ...
  }
};
</code></pre>
<ul>
<li>é€™è£¡å®šç¾©äº† <strong>å…©å€‹ AI æä¾›è€…çš„å‘¼å«æ–¹å¼</strong>ï¼š<code>openai</code> å’Œ <code>deepseek</code>ã€‚</li>
<li><strong>ç‰¹åˆ¥è¨­è¨ˆ</strong>ï¼šå¦‚æœ key æ²’è¨­å®š â†’ å›å‚³ä¸€å€‹ <strong>å‡å›è¦†ï¼ˆmockï¼‰</strong>ï¼Œæ–¹ä¾¿æœ¬åœ°æ¸¬è©¦ã€‚</li>
<li>å¦å‰‡å°±çœŸçš„å»å‘¼å« APIï¼ˆç”¨ <code>fetch</code> POST åˆ°å°æ‡‰çš„ API endpointï¼‰ã€‚</li>
<li>å›å‚³æ ¼å¼çµ±ä¸€ <code>{ text, raw }</code>ï¼Œ<code>text</code> æ˜¯ç°¡å–®çµæœï¼Œ<code>raw</code> æ˜¯å®Œæ•´ API å›è¦†ã€‚</li>
</ul>
<hr>
<h3 id="4-å¥åº·æª¢æŸ¥-API"><a href="#4-å¥åº·æª¢æŸ¥-API" class="headerlink" title="4. å¥åº·æª¢æŸ¥ API"></a>4. å¥åº·æª¢æŸ¥ API</h3><pre><code class="js">app.get(&#39;/health&#39;, (req, res) =&gt; res.json({ status: &#39;ok&#39;, role: &#39;mcp-gateway&#39; }));
</code></pre>
<ul>
<li>æä¾› <code>/health</code> APIï¼Œç¢ºèªä¼ºæœå™¨æ´»è‘—ã€‚</li>
<li>é€šå¸¸ç›£æ§ç³»çµ±æˆ– DevOps æœƒæ‰“é€™å€‹ä¾†æª¢æŸ¥æœå‹™æ˜¯å¦æ­£å¸¸ã€‚</li>
</ul>
<hr>
<h3 id="5-èŠå¤©-API"><a href="#5-èŠå¤©-API" class="headerlink" title="5. èŠå¤© API"></a>5. èŠå¤© API</h3><pre><code class="js">app.post(&#39;/api/chat&#39;, async (req, res) =&gt; {
  const { provider = &#39;openai&#39;, messages = [{ role:&#39;user&#39;, content:&#39;hello&#39; }] } = req.body;
  const adapter = providers[provider];
  if (!adapter) return res.status(400).json({ error: &#39;unknown provider&#39; });
  try {
    const { text, raw } = await adapter({ messages });
    return res.json({ provider, text, raw });
  } catch (err) {
    console.error(&#39;provider error&#39;, err);
    return res.status(500).json({ error: &#39;provider error&#39; });
  }
});
</code></pre>
<ul>
<li><p>é€™æ˜¯ä¸»è¦çš„ APIï¼š**<code>POST /api/chat</code>**ã€‚</p>
</li>
<li><p>Request body æ‡‰è©²åŒ…å«ï¼š</p>
<pre><code class="json">{
  &quot;provider&quot;: &quot;openai&quot;,
  &quot;messages&quot;: [{ &quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;hello&quot; }]
}
</code></pre>
</li>
<li><p>å¦‚æœæ²’æä¾›ï¼Œé è¨­å°±æ˜¯ <code>openai</code> + ä¸€å€‹ç°¡å–®è¨Šæ¯ã€‚</p>
</li>
<li><p>æ ¹æ“š provider ä¾†é¸æ“‡è¦å‘¼å«å“ªå€‹é©é…å™¨ã€‚</p>
</li>
<li><p>å¦‚æœ provider ä¸å­˜åœ¨ â†’ å›å‚³ 400ï¼ˆBad Requestï¼‰ã€‚</p>
</li>
<li><p>å¦‚æœ API å‘¼å«å¤±æ•— â†’ å›å‚³ 500ï¼ˆServer Errorï¼‰ã€‚</p>
</li>
<li><p>æˆåŠŸå°±å›å‚³ï¼š</p>
<pre><code class="json">{
  &quot;provider&quot;: &quot;openai&quot;,
  &quot;text&quot;: &quot;... AI å›è¦† ...&quot;,
  &quot;raw&quot;: { ...å®Œæ•´ API çµæœ... }
}
</code></pre>
</li>
</ul>
<hr>
<h3 id="6-å•Ÿå‹•ä¼ºæœå™¨"><a href="#6-å•Ÿå‹•ä¼ºæœå™¨" class="headerlink" title="6. å•Ÿå‹•ä¼ºæœå™¨"></a>6. å•Ÿå‹•ä¼ºæœå™¨</h3><pre><code class="js">const port = process.env.PORT || 4000;
app.listen(port, () =&gt; console.log(`MCP gateway listening on ${port}`));
</code></pre>
<ul>
<li>å¾ <code>.env</code> è®€å– <code>PORT</code>ï¼Œå¦‚æœæ²’è¨­å®šå°±ç”¨ <code>4000</code>ã€‚</li>
<li>å•Ÿå‹• Express ä¼ºæœå™¨ï¼Œç›£è½é€™å€‹ portã€‚</li>
<li>å•Ÿå‹•æˆåŠŸæœƒåœ¨çµ‚ç«¯æ©Ÿè¼¸å‡ºæç¤ºã€‚</li>
</ul>
<hr>
<h2 id="ğŸš©-é‡é»æ•´ç†"><a href="#ğŸš©-é‡é»æ•´ç†" class="headerlink" title="ğŸš© é‡é»æ•´ç†"></a>ğŸš© é‡é»æ•´ç†</h2><ol>
<li><p><strong>æ¨¡çµ„</strong></p>
<ul>
<li><code>express</code> â†’ Web ä¼ºæœå™¨</li>
<li><code>dotenv</code> â†’ è®€å– <code>.env</code></li>
</ul>
</li>
<li><p><strong>ç’°å¢ƒè®Šæ•¸ç®¡ç†</strong></p>
<ul>
<li>API Key éƒ½æ”¾åœ¨ <code>.env</code>ï¼Œä¸å¯«æ­»åœ¨ç¨‹å¼è£¡ã€‚</li>
<li>Key ç•™ç©ºæ™‚æœƒå› mock å›è¦†ï¼Œæ–¹ä¾¿æ¸¬è©¦ã€‚</li>
</ul>
</li>
<li><p><strong>API è·¯å¾‘</strong></p>
<ul>
<li><code>GET /health</code> â†’ æª¢æŸ¥æœå‹™ç‹€æ…‹</li>
<li><code>POST /api/chat</code> â†’ å‘¼å« AIï¼ˆæ”¯æ´ <code>openai</code>ã€<code>deepseek</code>ï¼‰</li>
</ul>
</li>
<li><p><strong>è¨­è¨ˆé‡é»</strong></p>
<ul>
<li><strong>Adapter Patternï¼ˆé©é…å™¨æ¨¡å¼ï¼‰</strong>ï¼šæ¯å€‹ provider éƒ½æ˜¯ä¸€å€‹ adapterï¼Œä»¥å¾Œè¦åŠ æ–° providerï¼ˆä¾‹å¦‚ Anthropicã€Geminiï¼‰ä¹Ÿå¾ˆå®¹æ˜“ã€‚</li>
<li><strong>éŒ¯èª¤è™•ç†</strong>ï¼šæœ‰ try&#x2F;catchï¼Œé¿å…ä¼ºæœå™¨ç›´æ¥æ›æ‰ã€‚</li>
<li><strong>Mock æ©Ÿåˆ¶</strong>ï¼šæ²’ API key ä¹Ÿèƒ½æœ¬åœ°è·‘é€šï¼Œé™ä½é–‹ç™¼é˜»åŠ›ã€‚</li>
</ul>
</li>
</ol>
<hr>
<p>è¦ä¸è¦æˆ‘å¹«ä½ ç•«ä¸€å€‹ <strong>è«‹æ±‚æµç¨‹åœ–</strong>ï¼ˆå¾å‰ç«¯ç™¼é€ â†’ gateway â†’ provider â†’ å›å‚³ï¼‰ï¼Ÿé€™æ¨£ä½ ä¸€çœ‹å°±èƒ½æ˜ç™½æ•´å€‹ Gateway çš„ä½œç”¨ã€‚</p>
