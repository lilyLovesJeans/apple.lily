<hr>
<h2 id="title-2025-07-15-Line-è¨‚å–®ç³»çµ±-D-éšæ®µ-â€”-Redis-å¿«å–èˆ‡è¨‚å–®ç‹€æ…‹é€šçŸ¥è¨­è¨ˆèˆ‡å¯¦ä½œdate-2025-11-13-23-37-32categories-OneDayOneNotetags-OneNote-Lineè¨‚å–®ç³»çµ±-description-2025-07-15-Line-è¨‚å–®ç³»çµ±-D-éšæ®µ-â€”-Redis-å¿«å–èˆ‡è¨‚å–®ç‹€æ…‹é€šçŸ¥è¨­è¨ˆèˆ‡å¯¦ä½œ"><a href="#title-2025-07-15-Line-è¨‚å–®ç³»çµ±-D-éšæ®µ-â€”-Redis-å¿«å–èˆ‡è¨‚å–®ç‹€æ…‹é€šçŸ¥è¨­è¨ˆèˆ‡å¯¦ä½œdate-2025-11-13-23-37-32categories-OneDayOneNotetags-OneNote-Lineè¨‚å–®ç³»çµ±-description-2025-07-15-Line-è¨‚å–®ç³»çµ±-D-éšæ®µ-â€”-Redis-å¿«å–èˆ‡è¨‚å–®ç‹€æ…‹é€šçŸ¥è¨­è¨ˆèˆ‡å¯¦ä½œ" class="headerlink" title="title: 2025-07-15 Line è¨‚å–®ç³»çµ±-D éšæ®µ â€” Redis å¿«å–èˆ‡è¨‚å–®ç‹€æ…‹é€šçŸ¥è¨­è¨ˆèˆ‡å¯¦ä½œdate: 2025-11-13 23:37:32categories: OneDayOneNotetags:  [OneNote, Lineè¨‚å–®ç³»çµ±]description: 2025-07-15 Line è¨‚å–®ç³»çµ±-D éšæ®µ â€” Redis å¿«å–èˆ‡è¨‚å–®ç‹€æ…‹é€šçŸ¥è¨­è¨ˆèˆ‡å¯¦ä½œ"></a>title: 2025-07-15 Line è¨‚å–®ç³»çµ±-D éšæ®µ â€” Redis å¿«å–èˆ‡è¨‚å–®ç‹€æ…‹é€šçŸ¥è¨­è¨ˆèˆ‡å¯¦ä½œ<br>date: 2025-11-13 23:37:32<br>categories: OneDayOneNote<br>tags:  [OneNote, Lineè¨‚å–®ç³»çµ±]<br>description: 2025-07-15 Line è¨‚å–®ç³»çµ±-D éšæ®µ â€” Redis å¿«å–èˆ‡è¨‚å–®ç‹€æ…‹é€šçŸ¥è¨­è¨ˆèˆ‡å¯¦ä½œ</h2><h2 id="2025-07-15-Line-è¨‚å–®ç³»çµ±-D-éšæ®µ-â€”-Redis-å¿«å–èˆ‡è¨‚å–®ç‹€æ…‹é€šçŸ¥è¨­è¨ˆèˆ‡å¯¦ä½œ"><a href="#2025-07-15-Line-è¨‚å–®ç³»çµ±-D-éšæ®µ-â€”-Redis-å¿«å–èˆ‡è¨‚å–®ç‹€æ…‹é€šçŸ¥è¨­è¨ˆèˆ‡å¯¦ä½œ" class="headerlink" title="2025-07-15 Line è¨‚å–®ç³»çµ±-D éšæ®µ â€” Redis å¿«å–èˆ‡è¨‚å–®ç‹€æ…‹é€šçŸ¥è¨­è¨ˆèˆ‡å¯¦ä½œ"></a>2025-07-15 Line è¨‚å–®ç³»çµ±-D éšæ®µ â€” Redis å¿«å–èˆ‡è¨‚å–®ç‹€æ…‹é€šçŸ¥è¨­è¨ˆèˆ‡å¯¦ä½œ</h2><p>ç¾åœ¨æ­£å¼é€²å…¥ï¼š</p>
<h1 id="ğŸ“’-D-éšæ®µ-â€”-Redis-å¿«å–èˆ‡è¨‚å–®ç‹€æ…‹é€šçŸ¥è¨­è¨ˆèˆ‡å¯¦ä½œ"><a href="#ğŸ“’-D-éšæ®µ-â€”-Redis-å¿«å–èˆ‡è¨‚å–®ç‹€æ…‹é€šçŸ¥è¨­è¨ˆèˆ‡å¯¦ä½œ" class="headerlink" title="ğŸ“’ D éšæ®µ â€” Redis å¿«å–èˆ‡è¨‚å–®ç‹€æ…‹é€šçŸ¥è¨­è¨ˆèˆ‡å¯¦ä½œ"></a>ğŸ“’ D éšæ®µ â€” Redis å¿«å–èˆ‡è¨‚å–®ç‹€æ…‹é€šçŸ¥è¨­è¨ˆèˆ‡å¯¦ä½œ</h1><p>é€™æ˜¯æ•´å€‹ LINE è¨‚å–®ç³»çµ±çš„ã€Œæ™ºæ…§åŒ–ã€éšæ®µï¼Œ<br>è®“ä½ çš„ç³»çµ±ä¸åƒ…èƒ½æ”¶å–®ï¼Œé‚„èƒ½<strong>å³æ™‚æ›´æ–°è¨‚å–®ç‹€æ…‹</strong>ã€<strong>æ¸›å°‘è³‡æ–™åº«è² æ“”</strong>ã€<strong>æ¨æ’­é€šçŸ¥ä½¿ç”¨è€…</strong>ã€‚</p>
<hr>
<h2 id="ğŸ§­-D-éšæ®µç›®æ¨™ç¸½è¦½"><a href="#ğŸ§­-D-éšæ®µç›®æ¨™ç¸½è¦½" class="headerlink" title="ğŸ§­ D éšæ®µç›®æ¨™ç¸½è¦½"></a>ğŸ§­ D éšæ®µç›®æ¨™ç¸½è¦½</h2><table>
<thead>
<tr>
<th>ç›®æ¨™</th>
<th>åŠŸèƒ½èªªæ˜</th>
</tr>
</thead>
<tbody><tr>
<td>âš¡ å¼•å…¥ Redis</td>
<td>ä½œç‚ºè¨‚å–®å¿«å–ï¼Œæ¸›å°‘é »ç¹çš„ MySQL æŸ¥è©¢</td>
</tr>
<tr>
<td>ğŸ”” å³æ™‚é€šçŸ¥æ©Ÿåˆ¶</td>
<td>ç•¶è¨‚å–®ç‹€æ…‹æ”¹è®Šæ™‚ï¼ˆä¾‹å¦‚ã€Œå·²æ¥å–®ã€ã€ã€Œé…é€ä¸­ã€ï¼‰ï¼ŒLINE å³æ™‚é€šçŸ¥ä½¿ç”¨è€…</td>
</tr>
<tr>
<td>ğŸ§© API æ•´åˆ</td>
<td>æä¾› <code>/api/orders/:id/status</code> æ›´æ–°è¨‚å–®ç‹€æ…‹çš„å¾Œç«¯ç«¯é»</td>
</tr>
<tr>
<td>ğŸ–¥ï¸ Vue3 å¾Œå°</td>
<td>ç®¡ç†è€…å¯åœ¨å¾Œå°é»æ“ŠæŒ‰éˆ•æ›´æ–°ç‹€æ…‹ï¼ˆä¸¦è§¸ç™¼æ¨æ’­ï¼‰</td>
</tr>
</tbody></table>
<hr>
<h2 id="âš™ï¸-ç³»çµ±æ¶æ§‹æ¦‚å¿µåœ–ï¼ˆD-éšæ®µï¼‰"><a href="#âš™ï¸-ç³»çµ±æ¶æ§‹æ¦‚å¿µåœ–ï¼ˆD-éšæ®µï¼‰" class="headerlink" title="âš™ï¸ ç³»çµ±æ¶æ§‹æ¦‚å¿µåœ–ï¼ˆD éšæ®µï¼‰"></a>âš™ï¸ ç³»çµ±æ¶æ§‹æ¦‚å¿µåœ–ï¼ˆD éšæ®µï¼‰</h2><pre><code> LINE ä½¿ç”¨è€…
       â†“
  LINE Messaging API
       â†“
  Node.js (Webhook) 
       â†•
  Redis â†â†’ MySQL
       â†•
  Vue3 å¾Œå° (ç®¡ç†è€…æ›´æ–°è¨‚å–®ç‹€æ…‹)
</code></pre>
<ul>
<li>Redisï¼šå¿«é€Ÿæš«å­˜è¨‚å–®ç‹€æ…‹ï¼Œé¿å…é‡æŸ¥ MySQLã€‚</li>
<li>MySQLï¼šæ­£å¼æŒä¹…å„²å­˜ã€‚</li>
<li>Vue å¾Œå°æ›´æ–°ç‹€æ…‹ â†’ Redis + MySQL æ›´æ–° â†’ LINE å³æ™‚é€šçŸ¥ã€‚</li>
</ul>
<hr>
<h2 id="ğŸ§±-å¯¦ä½œæ­¥é©Ÿ"><a href="#ğŸ§±-å¯¦ä½œæ­¥é©Ÿ" class="headerlink" title="ğŸ§± å¯¦ä½œæ­¥é©Ÿ"></a>ğŸ§± å¯¦ä½œæ­¥é©Ÿ</h2><hr>
<h3 id="ğŸ”¹-D1-â€”-å®‰è£-Redis-èˆ‡è¨­å®šé€£ç·š"><a href="#ğŸ”¹-D1-â€”-å®‰è£-Redis-èˆ‡è¨­å®šé€£ç·š" class="headerlink" title="ğŸ”¹ D1 â€” å®‰è£ Redis èˆ‡è¨­å®šé€£ç·š"></a>ğŸ”¹ D1 â€” å®‰è£ Redis èˆ‡è¨­å®šé€£ç·š</h3><h4 id="âœ…-åœ¨æœ¬æ©Ÿæˆ–é›²ç«¯å®‰è£-Redis"><a href="#âœ…-åœ¨æœ¬æ©Ÿæˆ–é›²ç«¯å®‰è£-Redis" class="headerlink" title="âœ… åœ¨æœ¬æ©Ÿæˆ–é›²ç«¯å®‰è£ Redis"></a>âœ… åœ¨æœ¬æ©Ÿæˆ–é›²ç«¯å®‰è£ Redis</h4><p>åœ¨ <strong>Lenovoï¼ˆWindowsï¼‰</strong> æˆ– <strong>Mac Air</strong> ä¸Šéƒ½å¯ç”¨ Dockerï¼š</p>
<pre><code class="bash">docker run --name redis -p 6379:6379 -d redis
</code></pre>
<h4 id="âœ…-å®‰è£-Node-js-å¥—ä»¶"><a href="#âœ…-å®‰è£-Node-js-å¥—ä»¶" class="headerlink" title="âœ… å®‰è£ Node.js å¥—ä»¶"></a>âœ… å®‰è£ Node.js å¥—ä»¶</h4><p>åœ¨ä½ çš„ backend å°ˆæ¡ˆä¸­ï¼š</p>
<pre><code class="bash">npm install redis
</code></pre>
<h4 id="âœ…-æ–°å¢-env-è®Šæ•¸"><a href="#âœ…-æ–°å¢-env-è®Šæ•¸" class="headerlink" title="âœ… æ–°å¢ .env è®Šæ•¸"></a>âœ… æ–°å¢ <code>.env</code> è®Šæ•¸</h4><pre><code>REDIS_HOST=127.0.0.1
REDIS_PORT=6379
</code></pre>
<hr>
<h3 id="ğŸ”¹-D2-â€”-å»ºç«‹-Redis-é€£ç·šå·¥å…·"><a href="#ğŸ”¹-D2-â€”-å»ºç«‹-Redis-é€£ç·šå·¥å…·" class="headerlink" title="ğŸ”¹ D2 â€” å»ºç«‹ Redis é€£ç·šå·¥å…·"></a>ğŸ”¹ D2 â€” å»ºç«‹ Redis é€£ç·šå·¥å…·</h3><p>ğŸ“ <code>backend/utils/redisClient.js</code></p>
<pre><code class="js">import { createClient } from &quot;redis&quot;;

const client = createClient({
  socket: {
    host: process.env.REDIS_HOST,
    port: process.env.REDIS_PORT,
  },
});

client.on(&quot;error&quot;, (err) =&gt; console.error(&quot;âŒ Redis éŒ¯èª¤:&quot;, err));
client.connect();

export default client;
</code></pre>
<hr>
<h3 id="ğŸ”¹-D3-â€”-ä¿®æ”¹-orders-js-æ”¯æ´-Redis-å¿«å–"><a href="#ğŸ”¹-D3-â€”-ä¿®æ”¹-orders-js-æ”¯æ´-Redis-å¿«å–" class="headerlink" title="ğŸ”¹ D3 â€” ä¿®æ”¹ orders.js æ”¯æ´ Redis å¿«å–"></a>ğŸ”¹ D3 â€” ä¿®æ”¹ <code>orders.js</code> æ”¯æ´ Redis å¿«å–</h3><p>ç•¶æŸ¥è©¢è¨‚å–®åˆ—è¡¨æ™‚ï¼Œæœƒå…ˆæŸ¥ Redisï¼Œæ²’æœ‰æ‰æŸ¥ MySQLã€‚<br>æ›´æ–°è¨‚å–®æ™‚ï¼ŒRedis èˆ‡ MySQL æœƒåŒæ­¥æ›´æ–°ã€‚</p>
<p>ğŸ“ <code>backend/routes/orders.js</code>ï¼ˆæ›´æ–°å¾Œç‰ˆæœ¬ï¼‰ï¼š</p>
<pre><code class="js">import express from &quot;express&quot;;
import mysql from &quot;mysql2/promise&quot;;
import redisClient from &quot;../utils/redisClient.js&quot;;
import axios from &quot;axios&quot;;

const router = express.Router();

const pool = mysql.createPool({
  host: process.env.DB_HOST,
  user: process.env.DB_USER,
  password: process.env.DB_PASSWORD,
  database: process.env.DB_NAME,
});

// âœ… æŸ¥è©¢æ‰€æœ‰è¨‚å–®ï¼ˆå« Redis å¿«å–ï¼‰
router.get(&quot;/orders&quot;, async (req, res) =&gt; {
  try {
    // å˜—è©¦å¾ Redis å–å¾—å¿«å–
    const cachedOrders = await redisClient.get(&quot;orders&quot;);
    if (cachedOrders) {
      console.log(&quot;ğŸ“¦ å¾ Redis å–å¾—è¨‚å–®è³‡æ–™&quot;);
      return res.json(JSON.parse(cachedOrders));
    }

    // æŸ¥è©¢ MySQL
    const [rows] = await pool.query(
      `SELECT o.id, o.user_name, p.name AS product_name, o.quantity, o.status, o.created_at
       FROM orders o
       LEFT JOIN products p ON o.product_id = p.id
       ORDER BY o.created_at DESC`
    );

    // å¯«å…¥ Redis å¿«å–ï¼ˆå­˜æ´» 60 ç§’ï¼‰
    await redisClient.setEx(&quot;orders&quot;, 60, JSON.stringify(rows));

    res.json(rows);
  } catch (err) {
    console.error(&quot;æŸ¥è©¢è¨‚å–®éŒ¯èª¤:&quot;, err);
    res.status(500).json({ error: &quot;ä¼ºæœå™¨éŒ¯èª¤&quot; });
  }
});

// âœ… æ›´æ–°è¨‚å–®ç‹€æ…‹ï¼ˆä¸¦æ¨æ’­ LINEï¼‰
router.put(&quot;/orders/:id/status&quot;, async (req, res) =&gt; {
  const orderId = req.params.id;
  const { newStatus, userName } = req.body;

  try {
    // æ›´æ–° MySQL
    await pool.query(`UPDATE orders SET status = ? WHERE id = ?`, [
      newStatus,
      orderId,
    ]);

    // æ›´æ–° Redis å¿«å–
    await redisClient.del(&quot;orders&quot;); // æ¸…æ‰èˆŠå¿«å–

    // æŸ¥æ‰¾ LINE ä½¿ç”¨è€…ï¼ˆå‡è¨­ userName å°æ‡‰ LINE userIdï¼‰
    const lineUserId = userName;

    // å‚³é€ LINE é€šçŸ¥
    if (lineUserId) {
      await axios.post(
        &quot;https://api.line.me/v2/bot/message/push&quot;,
        {
          to: lineUserId,
          messages: [
            {
              type: &quot;text&quot;,
              text: `ğŸ“¢ æ‚¨çš„è¨‚å–®ï¼ˆ#${orderId}ï¼‰ç‹€æ…‹å·²æ›´æ–°ç‚ºï¼šã€Œ${newStatus}ã€`,
            },
          ],
        },
        {
          headers: {
            &quot;Content-Type&quot;: &quot;application/json&quot;,
            Authorization: `Bearer ${process.env.LINE_CHANNEL_ACCESS_TOKEN}`,
          },
        }
      );
    }

    res.json({ success: true });
  } catch (err) {
    console.error(&quot;æ›´æ–°è¨‚å–®ç‹€æ…‹éŒ¯èª¤:&quot;, err);
    res.status(500).json({ error: &quot;ä¼ºæœå™¨éŒ¯èª¤&quot; });
  }
});

export default router;
</code></pre>
<hr>
<h3 id="ğŸ”¹-D4-â€”-Vue3-å¾Œå°æŒ‰éˆ•è§¸ç™¼æ›´æ–°"><a href="#ğŸ”¹-D4-â€”-Vue3-å¾Œå°æŒ‰éˆ•è§¸ç™¼æ›´æ–°" class="headerlink" title="ğŸ”¹ D4 â€” Vue3 å¾Œå°æŒ‰éˆ•è§¸ç™¼æ›´æ–°"></a>ğŸ”¹ D4 â€” Vue3 å¾Œå°æŒ‰éˆ•è§¸ç™¼æ›´æ–°</h3><p>ğŸ“ <code>frontend/src/views/LineOrders.vue</code>ï¼ˆéƒ¨åˆ†æ–°å¢å…§å®¹ï¼‰ï¼š</p>
<pre><code class="vue">&lt;td&gt;
  &lt;select v-model=&quot;order.status&quot; @change=&quot;updateStatus(order)&quot;&gt;
    &lt;option&gt;æ–°è¨‚å–®&lt;/option&gt;
    &lt;option&gt;å·²æ¥å–®&lt;/option&gt;
    &lt;option&gt;é…é€ä¸­&lt;/option&gt;
    &lt;option&gt;å·²å®Œæˆ&lt;/option&gt;
  &lt;/select&gt;
&lt;/td&gt;
</code></pre>
<pre><code class="js">const updateStatus = async (order) =&gt; {
  try {
    await axios.put(`http://localhost:3000/api/orders/${order.id}/status`, {
      newStatus: order.status,
      userName: order.user_name, // å°æ‡‰ LINE userId
    });
    alert(`è¨‚å–® #${order.id} ç‹€æ…‹å·²æ›´æ–°ç‚ºã€Œ${order.status}ã€`);
  } catch (err) {
    console.error(&quot;æ›´æ–°ç‹€æ…‹éŒ¯èª¤:&quot;, err);
  }
};
</code></pre>
<hr>
<h2 id="ğŸ§ª-æ¸¬è©¦æµç¨‹"><a href="#ğŸ§ª-æ¸¬è©¦æµç¨‹" class="headerlink" title="ğŸ§ª æ¸¬è©¦æµç¨‹"></a>ğŸ§ª æ¸¬è©¦æµç¨‹</h2><table>
<thead>
<tr>
<th>æ­¥é©Ÿ</th>
<th>å‹•ä½œ</th>
<th>çµæœ</th>
</tr>
</thead>
<tbody><tr>
<td>1ï¸âƒ£</td>
<td>å•Ÿå‹• Redis + Node.js</td>
<td>Redis å®¢æˆ¶ç«¯é€£ç·šæˆåŠŸ</td>
</tr>
<tr>
<td>2ï¸âƒ£</td>
<td>Vue3 å¾Œå°è¼‰å…¥è¨‚å–®æ¸…å–®</td>
<td>ç¬¬ä¸€æ¬¡å¾ MySQL æŸ¥è©¢ï¼Œä¹‹å¾Œå¾ Redis å¿«å–</td>
</tr>
<tr>
<td>3ï¸âƒ£</td>
<td>æ”¹è®Šè¨‚å–®ç‹€æ…‹ï¼ˆä¾‹å¦‚æ”¹ç‚ºã€Œå·²æ¥å–®ã€ï¼‰</td>
<td>Redis æ¸…å¿«å–ã€MySQL æ›´æ–°ã€LINE æ¨æ’­é€šçŸ¥</td>
</tr>
<tr>
<td>4ï¸âƒ£</td>
<td>å›åˆ° LINE App æª¢æŸ¥è¨Šæ¯</td>
<td>æ”¶åˆ°ã€Œæ‚¨çš„è¨‚å–®å·²æ›´æ–°ã€é€šçŸ¥ âœ…</td>
</tr>
</tbody></table>
<hr>
<h2 id="âœ…-D-éšæ®µå®Œæˆæˆæœ"><a href="#âœ…-D-éšæ®µå®Œæˆæˆæœ" class="headerlink" title="âœ… D éšæ®µå®Œæˆæˆæœ"></a>âœ… D éšæ®µå®Œæˆæˆæœ</h2><table>
<thead>
<tr>
<th>æ¨¡çµ„</th>
<th>ç‹€æ…‹</th>
</tr>
</thead>
<tbody><tr>
<td>Redis å¿«å–å°å…¥</td>
<td>âœ… å·²å®Œæˆ</td>
</tr>
<tr>
<td>è¨‚å–®ç‹€æ…‹å³æ™‚æ›´æ–°</td>
<td>âœ… å·²å®Œæˆ</td>
</tr>
<tr>
<td>LINE æ¨æ’­é€šçŸ¥</td>
<td>âœ… å·²å®Œæˆ</td>
</tr>
<tr>
<td>å‰ç«¯ç®¡ç†ä»‹é¢</td>
<td>âœ… å·²æ•´åˆ</td>
</tr>
</tbody></table>
<hr>
<h2 id="ğŸš€-ä¸‹ä¸€æ­¥ï¼ˆğŸ“•-E-éšæ®µé å‘Šï¼‰"><a href="#ğŸš€-ä¸‹ä¸€æ­¥ï¼ˆğŸ“•-E-éšæ®µé å‘Šï¼‰" class="headerlink" title="ğŸš€ ä¸‹ä¸€æ­¥ï¼ˆğŸ“• E éšæ®µé å‘Šï¼‰"></a>ğŸš€ ä¸‹ä¸€æ­¥ï¼ˆğŸ“• E éšæ®µé å‘Šï¼‰</h2><p>æ¥ä¸‹ä¾†çš„ <strong>E éšæ®µ</strong> å°‡æœƒé€²å…¥ï¼š</p>
<blockquote>
<p>ã€Œå‰ç«¯ä»‹é¢å„ªåŒ–ï¼ˆRWD + UI&#x2F;UXï¼‰ã€</p>
</blockquote>
<p>å…§å®¹åŒ…æ‹¬ï¼š</p>
<ul>
<li>ç¾åŒ– <code>LineOrders.vue</code>ï¼ˆRWDã€è‡ªå‹•æ›´æ–°ã€é€²åº¦æ¢ï¼‰</li>
<li>æ–°å¢ã€Œå³æ™‚åˆ·æ–°ã€æˆ–ã€ŒSocket å¯¦æ™‚è¨‚å–®ã€</li>
<li>å¼·åŒ–å‰ç«¯çš„ã€Œä½¿ç”¨è€…é«”é©—ã€</li>
</ul>
<hr>
<p>æ˜¯å¦è¦æˆ‘æ¥ä¸‹ä¾†å¹«ä½ é€²å…¥ ğŸ“• <strong>E éšæ®µ â€” Vue3 å‰ç«¯å„ªåŒ–ï¼ˆRWDï¼‹UI&#x2F;UX æ”¹ç‰ˆèˆ‡å³æ™‚åˆ·æ–°è¨­è¨ˆï¼‰</strong>ï¼Ÿ</p>
