<hr>
<h2 id="title-2025-03-10-天氣查詢應用程式」的最後一步date-2025-09-06-23-06-00categories-OneDayOneNotetags-Javascript-Vue-description-2025-03-10-天氣查詢應用程式」的最後一步"><a href="#title-2025-03-10-天氣查詢應用程式」的最後一步date-2025-09-06-23-06-00categories-OneDayOneNotetags-Javascript-Vue-description-2025-03-10-天氣查詢應用程式」的最後一步" class="headerlink" title="title: 2025-03-10-天氣查詢應用程式」的最後一步date: 2025-09-06 23:06:00categories: OneDayOneNotetags:  [Javascript,Vue]description: 2025-03-10-天氣查詢應用程式」的最後一步"></a>title: 2025-03-10-天氣查詢應用程式」的最後一步<br>date: 2025-09-06 23:06:00<br>categories: OneDayOneNote<br>tags:  [Javascript,Vue]<br>description: 2025-03-10-天氣查詢應用程式」的最後一步</h2><h1 id="2025-03-10-天氣查詢應用程式」的最後一步"><a href="#2025-03-10-天氣查詢應用程式」的最後一步" class="headerlink" title="2025-03-10-天氣查詢應用程式」的最後一步"></a>2025-03-10-天氣查詢應用程式」的最後一步</h1><template>
  <div class="container">
    <h2>🌦️ 天氣查詢應用程式</h2>
    <p>📅 資料時間：{{ queryDateText }}</p>

<pre><code>&lt;div class=&quot;checkbox-group&quot;&gt;
  &lt;label class=&quot;region-row&quot;&gt;
    &lt;span class=&quot;region-title&quot;&gt;全部：&lt;/span&gt;
    &lt;input
      type=&quot;checkbox&quot;
      value=&quot;全部&quot;
      v-model=&quot;selectedCities&quot;
      @change=&quot;handleAllToggle&quot;
    /&gt;
    &lt;span&gt;全部城市&lt;/span&gt;
  &lt;/label&gt;

  &lt;div v-for=&quot;(cities, region) in cityGroups&quot; :key=&quot;region&quot; class=&quot;region-row&quot;&gt;
    &lt;span class=&quot;region-title&quot;&gt;{{ region }}：&lt;/span&gt;
    &lt;label v-for=&quot;city in cities&quot; :key=&quot;city&quot; class=&quot;city-checkbox-inline&quot;&gt;
      &lt;input
        type=&quot;checkbox&quot;
        :value=&quot;city&quot;
        v-model=&quot;selectedCities&quot;
        :disabled=&quot;selectedCities.includes(&#39;全部&#39;)&quot;
      /&gt;
      {{ city }}
    &lt;/label&gt;
  &lt;/div&gt;
&lt;/div&gt;

&lt;p&gt;✅ 目前選擇：{{ selectedCities.join(&#39;, &#39;) }}&lt;/p&gt;

&lt;div class=&quot;weather-container&quot;&gt;
  &lt;div
    v-for=&quot;city in sortedWeatherData&quot;
    :key=&quot;city.locationName&quot;
    class=&quot;city-card&quot;
    :class=&quot;getWxClass(city)&quot;
  &gt;
    &lt;h3&gt;
      🌆 {{ city.locationName }}
      &lt;span class=&quot;weather-icon&quot;&gt;{{ getWxIcon(city) }}&lt;/span&gt;
    &lt;/h3&gt;
    &lt;p&gt;☀️ 天氣：{{ getWeatherElement(city, &#39;Wx&#39;) }}&lt;/p&gt;
    &lt;p&gt;🔥 最高溫：{{ getWeatherElement(city, &#39;MaxT&#39;) }}°C&lt;/p&gt;
    &lt;p&gt;❄️ 最低溫：{{ getWeatherElement(city, &#39;MinT&#39;) }}°C&lt;/p&gt;
    &lt;p&gt;🌧️ 降雨機率：{{ getWeatherElement(city, &#39;PoP&#39;) }}%&lt;/p&gt;
  &lt;/div&gt;
&lt;/div&gt;
</code></pre>
  </div>
</template>

<script setup>
import { ref, computed, onMounted } from 'vue'

const apiKey = 'CWA-290D12F1-3FA3-4A61-B613-623327DD04C2' // <<--- 請替換為你註冊的 CWA API Key
const url = `https://opendata.cwa.gov.tw/api/v1/rest/datastore/F-C0032-001?Authorization=${apiKey}`

const weatherData = ref([])
const selectedCities = ref(['全部'])
const queryDateText = ref('') // 🌟 顯示查詢時間

const cityGroups = {
  北部: ['臺北市', '新北市', '基隆市', '桃園市', '新竹縣', '新竹市'],
  中部: ['苗栗縣', '臺中市', '彰化縣', '南投縣', '雲林縣'],
  南部: ['嘉義市', '嘉義縣', '臺南市', '高雄市', '屏東縣'],
  東部: ['宜蘭縣', '花蓮縣', '臺東縣'],
  離島: ['澎湖縣', '金門縣', '連江縣']
}

const officialCityOrder = Object.values(cityGroups).flat()

onMounted(async () => {
  try {
    const response = await fetch(url)
    const data = await response.json()
    weatherData.value = data.records.location

    // 🌟 抓第一筆 Wx 的 startTime
    const firstWx = data.records.location?.[0]?.weatherElement.find(el => el.elementName === 'Wx')
    queryDateText.value = firstWx?.time[0]?.startTime || new Date().toLocaleString()
  } catch (error) {
    console.error('❌ 發生錯誤:', error)
  }
})

const sortedWeatherData = computed(() => {
  const filtered = selectedCities.value.includes('全部')
    ? weatherData.value
    : weatherData.value.filter(city =>
        selectedCities.value.includes(city.locationName)
      )

  return [...filtered].sort(
    (a, b) =>
      officialCityOrder.indexOf(a.locationName) -
      officialCityOrder.indexOf(b.locationName)
  )
})

function handleAllToggle() {
  if (selectedCities.value.includes('全部')) {
    selectedCities.value = ['全部']
  }
}

function getWeatherElement(city, elementName) {
  const element = city.weatherElement.find(el => el.elementName === elementName)
  return element?.time[0]?.parameter?.parameterName || 'N/A'
}

const wxClassMap = {
  '1': 'sunny',
  '2': 'cloudy',
  '3': 'partly-sunny',
  '4': 'overcast',
  '5': 'rainy',
  '6': 'rainy',
  '7': 'rainy',
  '8': 'rainy',
  '9': 'rainy',
  '10': 'rainy',
  '11': 'rainy',
  '12': 'rainy',
  '13': 'rainy',
  '14': 'rainy',
  '15': 'storm',
  '16': 'storm',
  '17': 'storm'
}

function getWxClass(city) {
  const wx = city.weatherElement.find(el => el.elementName === 'Wx')
  const code = wx?.time[0]?.parameter?.parameterValue
  return wxClassMap[code] || ''
}

function getWxIcon(city) {
  const wx = city.weatherElement.find(el => el.elementName === 'Wx')
  const code = wx?.time[0]?.parameter?.parameterValue
  const map = {
    '1': '☀️',
    '2': '☁️',
    '3': '🌤',
    '4': '🌥',
    '5': '🌧',
    '15': '⛈',
    '16': '⛈',
    '17': '⚡'
  }
  return map[code] || ''
}
</script>

<style scoped>
.container {
  margin-left: 10px;
}
h2 {
  font-size: 30px;
  margin-bottom: 0.5rem;
}
.checkbox-group {
  display: flex;
  flex-direction: column;
  gap: 0.75rem;
  margin-bottom: 1rem;
  font-size: 1rem;
}
.region-row {
  display: flex;
  align-items: center;
  flex-wrap: wrap;
  gap: 0.75rem;
}
.region-title {
  min-width: 4rem;
  font-weight: bold;
  color: #333;
}
.city-checkbox-inline {
  display: flex;
  align-items: center;
  gap: 0.3rem;
  background: #f5f5f5;
  padding: 0.3rem 0.6rem;
  border-radius: 0.4rem;
}
input[type='checkbox'] {
  accent-color: #3498db;
}

/* Weather cards */
.weather-container {
  display: flex;
  flex-wrap: wrap;
  gap: 1.5rem;
}
.city-card {
  flex: 1 1 300px;
  max-width: 300px;
  padding: 1rem;
  border-radius: 0.75rem;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  border-left: 6px solid #3498db;
  transition: background 0.3s ease;
}
.city-card.sunny {
  background: linear-gradient(#ffe082, #ffd54f);
  border-left-color: #fbc02d;
}
.city-card.cloudy {
  background: linear-gradient(#d7dde8, #cfd8dc);
  border-left-color: #90a4ae;
}
.city-card.partly-sunny {
  background: linear-gradient(#fff8e1, #ffe082);
  border-left-color: #fbc02d;
}
.city-card.overcast {
  background: linear-gradient(#b0bec5, #90a4ae);
  border-left-color: #607d8b;
}
.city-card.rainy {
  background: linear-gradient(#a5c8ff, #81d4fa);
  border-left-color: #0288d1;
}
.city-card.storm {
  background: linear-gradient(#616161, #9e9e9e);
  border-left-color: #ffca28;
}
.weather-icon {
  margin-left: 0.5rem;
}
</style>
