<hr>
<h2 id="title-2025-07-12-Line-è¨‚å–®ç³»çµ±-C-éšæ®µ-å»ºç«‹å…©å€‹å¯¦éš›å¯åŸ·è¡Œçš„æ ¸å¿ƒæª”æ¡ˆ-Webhookhookå¾Œç«¯-Vueå‰ç«¯è¨‚å–®è¨˜éŒ„é é¢date-2025-11-13-23-14-49categories-OneDayOneNotetags-OneNote-Lineè¨‚å–®ç³»çµ±-description-2025-07-12-Line-è¨‚å–®ç³»çµ±-C-éšæ®µ-å»ºç«‹å…©å€‹å¯¦éš›å¯åŸ·è¡Œçš„æ ¸å¿ƒæª”æ¡ˆ-Webhookhookå¾Œç«¯-Vueå‰ç«¯è¨‚å–®è¨˜éŒ„é é¢"><a href="#title-2025-07-12-Line-è¨‚å–®ç³»çµ±-C-éšæ®µ-å»ºç«‹å…©å€‹å¯¦éš›å¯åŸ·è¡Œçš„æ ¸å¿ƒæª”æ¡ˆ-Webhookhookå¾Œç«¯-Vueå‰ç«¯è¨‚å–®è¨˜éŒ„é é¢date-2025-11-13-23-14-49categories-OneDayOneNotetags-OneNote-Lineè¨‚å–®ç³»çµ±-description-2025-07-12-Line-è¨‚å–®ç³»çµ±-C-éšæ®µ-å»ºç«‹å…©å€‹å¯¦éš›å¯åŸ·è¡Œçš„æ ¸å¿ƒæª”æ¡ˆ-Webhookhookå¾Œç«¯-Vueå‰ç«¯è¨‚å–®è¨˜éŒ„é é¢" class="headerlink" title="title: 2025-07-12 Line è¨‚å–®ç³»çµ±-C éšæ®µ å»ºç«‹å…©å€‹å¯¦éš›å¯åŸ·è¡Œçš„æ ¸å¿ƒæª”æ¡ˆ Webhookhookå¾Œç«¯ Vueå‰ç«¯è¨‚å–®è¨˜éŒ„é é¢date: 2025-11-13 23:14:49categories: OneDayOneNotetags:  [OneNote, Lineè¨‚å–®ç³»çµ±]description: 2025-07-12 Line è¨‚å–®ç³»çµ±-C éšæ®µ å»ºç«‹å…©å€‹å¯¦éš›å¯åŸ·è¡Œçš„æ ¸å¿ƒæª”æ¡ˆ Webhookhookå¾Œç«¯ Vueå‰ç«¯è¨‚å–®è¨˜éŒ„é é¢"></a>title: 2025-07-12 Line è¨‚å–®ç³»çµ±-C éšæ®µ å»ºç«‹å…©å€‹å¯¦éš›å¯åŸ·è¡Œçš„æ ¸å¿ƒæª”æ¡ˆ Webhookhookå¾Œç«¯ Vueå‰ç«¯è¨‚å–®è¨˜éŒ„é é¢<br>date: 2025-11-13 23:14:49<br>categories: OneDayOneNote<br>tags:  [OneNote, Lineè¨‚å–®ç³»çµ±]<br>description: 2025-07-12 Line è¨‚å–®ç³»çµ±-C éšæ®µ å»ºç«‹å…©å€‹å¯¦éš›å¯åŸ·è¡Œçš„æ ¸å¿ƒæª”æ¡ˆ Webhookhookå¾Œç«¯ Vueå‰ç«¯è¨‚å–®è¨˜éŒ„é é¢</h2><h2 id="2025-07-12-Line-è¨‚å–®ç³»çµ±-C-éšæ®µ-å»ºç«‹å…©å€‹å¯¦éš›å¯åŸ·è¡Œçš„æ ¸å¿ƒæª”æ¡ˆ-Webhookhookå¾Œç«¯-Vueå‰ç«¯è¨‚å–®è¨˜éŒ„é é¢"><a href="#2025-07-12-Line-è¨‚å–®ç³»çµ±-C-éšæ®µ-å»ºç«‹å…©å€‹å¯¦éš›å¯åŸ·è¡Œçš„æ ¸å¿ƒæª”æ¡ˆ-Webhookhookå¾Œç«¯-Vueå‰ç«¯è¨‚å–®è¨˜éŒ„é é¢" class="headerlink" title="2025-07-12 Line è¨‚å–®ç³»çµ±-C éšæ®µ å»ºç«‹å…©å€‹å¯¦éš›å¯åŸ·è¡Œçš„æ ¸å¿ƒæª”æ¡ˆ Webhookhookå¾Œç«¯ Vueå‰ç«¯è¨‚å–®è¨˜éŒ„é é¢"></a>2025-07-12 Line è¨‚å–®ç³»çµ±-C éšæ®µ å»ºç«‹å…©å€‹å¯¦éš›å¯åŸ·è¡Œçš„æ ¸å¿ƒæª”æ¡ˆ Webhookhookå¾Œç«¯ Vueå‰ç«¯è¨‚å–®è¨˜éŒ„é é¢</h2><p>æˆ‘å€‘ç¾åœ¨å°±å®Œæ•´é€²å…¥ <strong>ğŸ“˜ éšæ®µ C â€” LINE è¨‚å–®æ•´åˆï¼ˆå‰ç«¯ï¼‹å¾Œç«¯é€£å‹•ï¼‰</strong> çš„å¯¦ä½œéšæ®µã€‚</p>
<p>æ¥ä¸‹ä¾†æˆ‘æœƒå¹«ä½ å»ºç«‹å…©å€‹å¯¦éš›å¯åŸ·è¡Œçš„æ ¸å¿ƒæª”æ¡ˆï¼š<br>1ï¸âƒ£ <code>backend/routes/lineWebhook.js</code> â€” Node.js Webhook å¾Œç«¯<br>2ï¸âƒ£ <code>frontend/src/views/LineOrders.vue</code> â€” Vue3 å‰ç«¯è¨‚å–®ç´€éŒ„é é¢</p>
<hr>
<h2 id="ğŸ§©-ä¸€ã€Node-js-å¾Œç«¯-â€”-backend-routes-lineWebhook-js"><a href="#ğŸ§©-ä¸€ã€Node-js-å¾Œç«¯-â€”-backend-routes-lineWebhook-js" class="headerlink" title="ğŸ§© ä¸€ã€Node.js å¾Œç«¯ â€” backend/routes/lineWebhook.js"></a>ğŸ§© ä¸€ã€Node.js å¾Œç«¯ â€” <code>backend/routes/lineWebhook.js</code></h2><p>é€™å€‹æª”æ¡ˆçš„ä½œç”¨æ˜¯ï¼š</p>
<blockquote>
<p>è®“ LINE Bot æŠŠä½¿ç”¨è€…è¨Šæ¯ï¼ˆä¾‹å¦‚è¼¸å…¥ã€Œå•†å“123ã€ï¼‰å‚³åˆ°ä½ çš„å¾Œç«¯ï¼Œ<br>å¾Œç«¯æŸ¥ MySQL å›å‚³å•†å“è³‡æ–™ï¼Œå†ç”¨ LINE API å›è¦†çµ¦ä½¿ç”¨è€…ã€‚</p>
</blockquote>
<pre><code class="js">// backend/routes/lineWebhook.js
import express from &quot;express&quot;;
import axios from &quot;axios&quot;;
import crypto from &quot;crypto&quot;;
import mysql from &quot;mysql2/promise&quot;;

const router = express.Router();

// å»ºç«‹ MySQL é€£ç·šæ± 
const pool = mysql.createPool({
  host: process.env.DB_HOST,
  user: process.env.DB_USER,
  password: process.env.DB_PASSWORD,
  database: process.env.DB_NAME,
});

// é©—è­‰ LINE webhook ç°½ç« 
function validateSignature(body, signature) {
  const hash = crypto
    .createHmac(&quot;SHA256&quot;, process.env.LINE_CHANNEL_SECRET)
    .update(JSON.stringify(body))
    .digest(&quot;base64&quot;);
  return hash === signature;
}

// è™•ç† Webhook
router.post(&quot;/webhook&quot;, async (req, res) =&gt; {
  const signature = req.headers[&quot;x-line-signature&quot;];
  if (!validateSignature(req.body, signature)) {
    return res.status(401).send(&quot;Invalid signature&quot;);
  }

  const events = req.body.events;
  for (const event of events) {
    if (event.type === &quot;message&quot; &amp;&amp; event.message.type === &quot;text&quot;) {
      const userText = event.message.text.trim();

      // æª¢æŸ¥æ˜¯å¦ç‚ºæŸ¥è©¢å•†å“
      if (userText.startsWith(&quot;å•†å“&quot;)) {
        const itemCode = userText.replace(&quot;å•†å“&quot;, &quot;&quot;).trim();
        const [rows] = await pool.query(
          &quot;SELECT name, price, description FROM products WHERE id = ?&quot;,
          [itemCode]
        );

        let replyMessage = &quot;&quot;;
        if (rows.length &gt; 0) {
          const product = rows[0];
          replyMessage = `ğŸ“¦ å•†å“åç¨±ï¼š${product.name}\nğŸ’² åƒ¹æ ¼ï¼š${product.price}\nğŸ“ èªªæ˜ï¼š${product.description}`;
        } else {
          replyMessage = &quot;æŸ¥ç„¡æ­¤å•†å“ï¼Œè«‹ç¢ºèªä»£è™Ÿæ˜¯å¦æ­£ç¢ºã€‚&quot;;
        }

        await axios.post(
          &quot;https://api.line.me/v2/bot/message/reply&quot;,
          {
            replyToken: event.replyToken,
            messages: [{ type: &quot;text&quot;, text: replyMessage }],
          },
          {
            headers: {
              &quot;Content-Type&quot;: &quot;application/json&quot;,
              Authorization: `Bearer ${process.env.LINE_CHANNEL_ACCESS_TOKEN}`,
            },
          }
        );
      }
    }
  }

  res.status(200).end();
});

export default router;
</code></pre>
<hr>
<h2 id="ğŸ“-æª”æ¡ˆæ•´åˆèªªæ˜"><a href="#ğŸ“-æª”æ¡ˆæ•´åˆèªªæ˜" class="headerlink" title="ğŸ“ æª”æ¡ˆæ•´åˆèªªæ˜"></a>ğŸ“ æª”æ¡ˆæ•´åˆèªªæ˜</h2><p>è«‹ç¢ºèª <code>backend/server.js</code> ä¸­æœ‰åŠ å…¥é€™æ®µï¼š</p>
<pre><code class="js">import lineWebhook from &quot;./routes/lineWebhook.js&quot;;
app.use(express.json());
app.use(&quot;/api&quot;, lineWebhook);
</code></pre>
<p>ç„¶å¾Œ <code>.env</code> éœ€æœ‰ä»¥ä¸‹åƒæ•¸ï¼š</p>
<pre><code>LINE_CHANNEL_SECRET=ä½ çš„LINE_CHANNEL_SECRET
LINE_CHANNEL_ACCESS_TOKEN=ä½ çš„LINE_CHANNEL_ACCESS_TOKEN
</code></pre>
<hr>
<h2 id="ğŸ§©-äºŒã€Vue3-å‰ç«¯-â€”-frontend-src-views-LineOrders-vue"><a href="#ğŸ§©-äºŒã€Vue3-å‰ç«¯-â€”-frontend-src-views-LineOrders-vue" class="headerlink" title="ğŸ§© äºŒã€Vue3 å‰ç«¯ â€” frontend/src/views/LineOrders.vue"></a>ğŸ§© äºŒã€Vue3 å‰ç«¯ â€” <code>frontend/src/views/LineOrders.vue</code></h2><p>é€™å€‹é é¢ä¸»è¦è®“ç®¡ç†è€…åœ¨å¾Œå°çœ‹åˆ°æ‰€æœ‰ä¾†è‡ª LINE çš„è¨‚å–®ç´€éŒ„ã€‚</p>
<p>å‡è¨­ä½ çš„å¾Œç«¯æœ‰ä¸€å€‹ <code>/api/orders</code> APIï¼Œå¯ä»¥å›å‚³ LINE é€é€²è³‡æ–™åº«çš„è¨‚å–®è³‡æ–™ã€‚</p>
<pre><code class="vue">&lt;template&gt;
  &lt;div class=&quot;line-orders&quot;&gt;
    &lt;h1&gt;ğŸ“± LINE è¨‚å–®ç´€éŒ„&lt;/h1&gt;

    &lt;div v-if=&quot;loading&quot;&gt;è®€å–ä¸­...&lt;/div&gt;
    &lt;div v-else&gt;
      &lt;table&gt;
        &lt;thead&gt;
          &lt;tr&gt;
            &lt;th&gt;è¨‚å–®ç·¨è™Ÿ&lt;/th&gt;
            &lt;th&gt;ç”¨æˆ¶åç¨±&lt;/th&gt;
            &lt;th&gt;å•†å“åç¨±&lt;/th&gt;
            &lt;th&gt;æ•¸é‡&lt;/th&gt;
            &lt;th&gt;ç‹€æ…‹&lt;/th&gt;
            &lt;th&gt;å»ºç«‹æ™‚é–“&lt;/th&gt;
          &lt;/tr&gt;
        &lt;/thead&gt;
        &lt;tbody&gt;
          &lt;tr v-for=&quot;order in orders&quot; :key=&quot;order.id&quot;&gt;
            &lt;td&gt;{{ order.id }}&lt;/td&gt;
            &lt;td&gt;{{ order.user_name }}&lt;/td&gt;
            &lt;td&gt;{{ order.product_name }}&lt;/td&gt;
            &lt;td&gt;{{ order.quantity }}&lt;/td&gt;
            &lt;td&gt;{{ order.status }}&lt;/td&gt;
            &lt;td&gt;{{ new Date(order.created_at).toLocaleString() }}&lt;/td&gt;
          &lt;/tr&gt;
        &lt;/tbody&gt;
      &lt;/table&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script setup&gt;
import { ref, onMounted } from &quot;vue&quot;;
import axios from &quot;axios&quot;;

const orders = ref([]);
const loading = ref(true);

onMounted(async () =&gt; {
  try {
    const res = await axios.get(&quot;http://localhost:3000/api/orders&quot;);
    orders.value = res.data;
  } catch (err) {
    console.error(&quot;ç„¡æ³•å–å¾—è¨‚å–®è³‡æ–™ï¼š&quot;, err);
  } finally {
    loading.value = false;
  }
});
&lt;/script&gt;

&lt;style scoped&gt;
.line-orders {
  padding: 1.5rem;
}
table {
  width: 100%;
  border-collapse: collapse;
}
th, td {
  border: 1px solid #ddd;
  padding: 8px;
}
th {
  background: #f5f5f5;
}
&lt;/style&gt;
</code></pre>
<hr>
<h2 id="âš™ï¸-å‰å¾Œç«¯é€£å‹•æ¸¬è©¦æµç¨‹"><a href="#âš™ï¸-å‰å¾Œç«¯é€£å‹•æ¸¬è©¦æµç¨‹" class="headerlink" title="âš™ï¸ å‰å¾Œç«¯é€£å‹•æ¸¬è©¦æµç¨‹"></a>âš™ï¸ å‰å¾Œç«¯é€£å‹•æ¸¬è©¦æµç¨‹</h2><table>
<thead>
<tr>
<th>æ­¥é©Ÿ</th>
<th>å‹•ä½œ</th>
<th>èªªæ˜</th>
</tr>
</thead>
<tbody><tr>
<td>â‘ </td>
<td>å•Ÿå‹• MySQLã€Node.js (<code>npm run dev</code>)</td>
<td>ç¢ºä¿ <code>/api/webhook</code> å¯ä»¥æ¥æ”¶è«‹æ±‚</td>
</tr>
<tr>
<td>â‘¡</td>
<td>ä½¿ç”¨ ngrok å°‡ä½ çš„ port 3000 å°å¤–å…¬é–‹</td>
<td><code>ngrok http 3000</code></td>
</tr>
<tr>
<td>â‘¢</td>
<td>åœ¨ LINE Developers â†’ Messaging API â†’ Webhook URL è¨­å®š <code>https://&lt;ngrok-url&gt;/api/webhook</code></td>
<td>æ¸¬è©¦è¨Šæ¯å‚³é</td>
</tr>
<tr>
<td>â‘£</td>
<td>åœ¨ LINE è¼¸å…¥ã€Œå•†å“ 1ã€</td>
<td>å¾Œç«¯æŸ¥ MySQLï¼Œå›å‚³å•†å“è³‡è¨Š</td>
</tr>
<tr>
<td>â‘¤</td>
<td>åœ¨ Vue3 å¾Œå° <code>LineOrders.vue</code> æª¢è¦–è¨‚å–®ç´€éŒ„</td>
<td>é©—è­‰è³‡æ–™æµæ˜¯å¦å®Œæ•´</td>
</tr>
</tbody></table>
<hr>
<p>æ˜¯å¦è¦æˆ‘å¹«ä½ ç¹¼çºŒç”¢ç”Ÿï¼š<br>ğŸ‘‰ å°æ‡‰çš„ <code>/api/orders</code> å¾Œç«¯ APIï¼ˆè®“ <code>LineOrders.vue</code> å¯ä»¥æ­£å¸¸é¡¯ç¤ºè¨‚å–®ï¼‰ï¼Ÿ<br>é€™æœƒæ˜¯ <strong>C4 å­éšæ®µ</strong> çš„æœ€å¾Œä¸€å¡Šæ‹¼åœ–ã€‚</p>
